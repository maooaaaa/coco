<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeStation V2 | è¶…ãƒ»ä¸‡èƒ½ãƒ„ãƒ¼ãƒ«</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #4f46e5; --primary-hover: #4338ca;
            --bg: #f3f4f6; --sidebar: #ffffff; --card-bg: #ffffff;
            --text: #1f2937; --text-sub: #6b7280; --border: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        [data-theme="dark"] {
            --primary: #818cf8; --primary-hover: #6366f1;
            --bg: #0f172a; --sidebar: #1e293b; --card-bg: #1e293b;
            --text: #f1f5f9; --text-sub: #94a3b8; --border: #334155;
        }

        * { box-sizing: border-box; outline: none; transition: background 0.3s, color 0.3s; }
        body { margin: 0; font-family: 'Helvetica Neue', Arial, sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }
        
        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar { width: 260px; background: var(--sidebar); display: flex; flex-direction: column; border-right: 1px solid var(--border); padding: 20px 0; flex-shrink: 0; z-index: 10; }
        .logo { font-size: 22px; font-weight: bold; text-align: center; margin-bottom: 20px; color: var(--primary); display: flex; align-items: center; justify-content: center; gap: 10px; }
        .user-panel { padding: 0 20px 20px; border-bottom: 1px solid var(--border); margin-bottom: 10px; }
        .user-name { font-weight: bold; font-size: 16px; }
        .user-rank { font-size: 12px; color: var(--text-sub); background: rgba(79, 70, 229, 0.1); padding: 2px 8px; border-radius: 10px; display: inline-block; margin-top: 5px; }

        .menu-area { overflow-y: auto; flex: 1; }
        .menu-item { padding: 12px 20px; cursor: pointer; color: var(--text-sub); font-weight: 500; display: flex; align-items: center; gap: 10px; border-left: 4px solid transparent; }
        .menu-item:hover, .menu-item.active { background: rgba(79, 70, 229, 0.05); color: var(--primary); border-left-color: var(--primary); }
        
        .sidebar-footer { padding: 20px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .theme-toggle { cursor: pointer; font-size: 20px; color: var(--text-sub); }

        /* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
        .main { flex: 1; display: flex; flex-direction: column; height: 100vh; position: relative; }
        .header { height: 60px; background: var(--sidebar); border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 30px; justify-content: space-between; }
        .search-box { width: 300px; padding: 8px 15px; border-radius: 20px; border: 1px solid var(--border); background: var(--bg); color: var(--text); }
        
        .content { padding: 30px; overflow-y: auto; flex: 1; position: relative; }
        
        /* ã‚«ãƒ¼ãƒ‰ã‚°ãƒªãƒƒãƒ‰ */
        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding-bottom: 50px; }
        .tool-card { 
            background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: var(--shadow); 
            cursor: pointer; position: relative; border: 1px solid var(--border); display: flex; flex-direction: column; gap: 10px;
        }
        .tool-card:hover { transform: translateY(-3px); border-color: var(--primary); }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .card-icon { font-size: 24px; color: var(--primary); background: rgba(79, 70, 229, 0.1); width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 10px; }
        .fav-btn { color: #d1d5db; font-size: 18px; cursor: pointer; transition: 0.2s; }
        .fav-btn.active { color: #fbbf24; }
        .fav-btn:hover { transform: scale(1.2); }

        .card-title { font-weight: bold; font-size: 16px; margin-top: 5px; }
        .card-desc { font-size: 13px; color: var(--text-sub); line-height: 1.4; }

        /* å€‹åˆ¥ãƒ„ãƒ¼ãƒ«ç”»é¢ */
        .tool-view { display: none; background: var(--card-bg); padding: 30px; border-radius: 15px; max-width: 800px; margin: 0 auto; box-shadow: var(--shadow); border: 1px solid var(--border); }
        .tool-view.active { display: block; animation: fadeIn 0.3s; }
        .back-btn { margin-bottom: 20px; cursor: pointer; color: var(--text-sub); display: inline-flex; align-items: center; gap: 5px; }
        .back-btn:hover { color: var(--primary); }
        
        /* å±¥æ­´ï¼ˆãƒ­ã‚°ï¼‰ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; display: none; justify-content: center; align-items: center; backdrop-filter: blur(3px); }
        .modal-box { background: var(--card-bg); width: 90%; max-width: 500px; border-radius: 12px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); max-height: 80vh; display: flex; flex-direction: column; }
        .modal-header { font-weight: bold; font-size: 20px; margin-bottom: 15px; display: flex; justify-content: space-between; }
        .log-list { overflow-y: auto; flex: 1; border-top: 1px solid var(--border); }
        .log-item { padding: 10px; border-bottom: 1px solid var(--border); font-size: 14px; }
        .log-time { font-size: 11px; color: var(--text-sub); }
        
        /* ãƒ•ã‚©ãƒ¼ãƒ éƒ¨å“ */
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid var(--border); background: var(--bg); color: var(--text); border-radius: 8px; margin-bottom: 15px; font-size: 16px; }
        button.action-btn { background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; }
        button.action-btn:hover { background: var(--primary-hover); }
        .result-area { background: rgba(79, 70, 229, 0.05); padding: 20px; border-radius: 8px; margin-top: 20px; border: 1px solid var(--primary); font-size: 18px; font-weight: bold; text-align: center; color: var(--text); word-break: break-all; }

        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar { width: 100%; height: auto; flex-direction: row; overflow-x: auto; padding: 10px; border-right: none; border-bottom: 1px solid var(--border); }
            .user-panel, .sidebar-footer { display: none; } /* ã‚¹ãƒãƒ›ã§ã¯ç°¡æ˜“åŒ– */
            .menu-area { display: flex; }
            .menu-item { white-space: nowrap; border-left: none; border-bottom: 3px solid transparent; }
            .menu-item.active { border-left: none; border-bottom-color: var(--primary); }
            .content { padding: 15px; }
        }
        @keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
    </style>
</head>
<body>

    <div id="login-modal" class="modal-overlay" style="display:flex;">
        <div class="modal-box" style="text-align:center;">
            <h2>ğŸ‘‹ ã‚ˆã†ã“ã LifeStation ã¸</h2>
            <p>ã‚ãªãŸã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚<br><span style="font-size:12px; color:#888;">(ãƒ‡ãƒ¼ã‚¿ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™)</span></p>
            <input type="text" id="username-input" placeholder="ä¾‹: ãƒ†ãƒƒã‚¯å¤ªéƒ">
            <button class="action-btn" onclick="registerUser()">åˆ©ç”¨ã‚’é–‹å§‹ã™ã‚‹</button>
        </div>
    </div>

    <div id="log-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <span>ğŸ“œ ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°</span>
                <span onclick="toggleLog()" style="cursor:pointer;">Ã—</span>
            </div>
            <div class="log-list" id="log-container">
                </div>
            <button class="action-btn" style="margin-top:10px; background:#ef4444;" onclick="clearLogs()">å±¥æ­´ã‚’å‰Šé™¤</button>
        </div>
    </div>

    <nav class="sidebar">
        <div class="logo"><i class="fas fa-atom"></i> LifeStation V2</div>
        
        <div class="user-panel">
            <div class="user-name" id="disp-name">ã‚²ã‚¹ãƒˆ</div>
            <div class="user-rank" id="disp-rank">ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ä¼šå“¡</div>
        </div>

        <div class="menu-area">
            <div class="menu-item active" onclick="filterCategory('all')"><i class="fas fa-th"></i> ã™ã¹ã¦</div>
            <div class="menu-item" onclick="filterCategory('fav')"><i class="fas fa-star" style="color:#fbbf24;"></i> ãŠæ°—ã«å…¥ã‚Š</div>
            <div class="menu-item" onclick="filterCategory('calc')"><i class="fas fa-calculator"></i> è¨ˆç®—ãƒ»æŠ•è³‡</div>
            <div class="menu-item" onclick="filterCategory('date')"><i class="fas fa-clock"></i> æ™‚é–“ãƒ»æ—¥ä»˜</div>
            <div class="menu-item" onclick="filterCategory('text')"><i class="fas fa-font"></i> ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†</div>
            <div class="menu-item" onclick="filterCategory('dev')"><i class="fas fa-code"></i> é–‹ç™ºãƒ»Web</div>
            <div class="menu-item" onclick="filterCategory('life')"><i class="fas fa-coffee"></i> ç”Ÿæ´»ãƒ»ä¾¿åˆ©</div>
        </div>

        <div class="sidebar-footer">
            <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
            <div class="theme-toggle" onclick="toggleLog()" title="å±¥æ­´ã‚’è¦‹ã‚‹"><i class="fas fa-history"></i></div>
            <div class="theme-toggle" onclick="logout()" title="ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ"><i class="fas fa-sign-out-alt"></i></div>
        </div>
    </nav>

    <div class="main">
        <header class="header">
            <h3 id="page-title" style="margin:0;">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
            <input type="text" class="search-box" placeholder="ãƒ„ãƒ¼ãƒ«ã‚’æ¤œç´¢ (ä¾‹: æŠ•è³‡, ToDo)..." oninput="searchTools(this.value)">
        </header>

        <div class="content">
            <div id="grid-container" class="grid-container"></div>
            <div id="tool-stage"></div>
        </div>
    </div>

    <script>
        // --- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  (Local Storage) ---
        const DB = {
            get: (key) => JSON.parse(localStorage.getItem('ls_v2_' + key) || 'null'),
            set: (key, val) => localStorage.setItem('ls_v2_' + key, JSON.stringify(val)),
            del: (key) => localStorage.removeItem('ls_v2_' + key)
        };

        let currentUser = DB.get('user');
        let favorites = DB.get('favs') || [];
        let logs = DB.get('logs') || [];

        // åˆæœŸåŒ–
        window.onload = () => {
            if (!currentUser) {
                document.getElementById('login-modal').style.display = 'flex';
            } else {
                initApp();
            }
            if(DB.get('theme') === 'dark') document.body.setAttribute('data-theme', 'dark');
        };

        function registerUser() {
            const name = document.getElementById('username-input').value || 'åç„¡ã—';
            currentUser = { name: name, joined: new Date().toISOString(), usageCount: 0 };
            DB.set('user', currentUser);
            document.getElementById('login-modal').style.display = 'none';
            initApp();
        }

        function initApp() {
            document.getElementById('login-modal').style.display = 'none';
            document.getElementById('disp-name').innerText = currentUser.name + ' ã•ã‚“';
            updateRank();
            renderGrid();
        }

        function updateRank() {
            const count = currentUser.usageCount;
            let rank = "ãƒ“ã‚®ãƒŠãƒ¼ä¼šå“¡";
            if(count > 10) rank = "ã‚·ãƒ«ãƒãƒ¼ä¼šå“¡";
            if(count > 50) rank = "ã‚´ãƒ¼ãƒ«ãƒ‰ä¼šå“¡";
            if(count > 100) rank = "ãƒ—ãƒ©ãƒãƒŠä¼šå“¡";
            document.getElementById('disp-rank').innerText = rank;
        }

        function logout() {
            if(confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.clear();
                location.reload();
            }
        }

        // --- ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ  ---
        function addLog(toolName, resultText) {
            logs.unshift({ time: new Date().toLocaleString(), tool: toolName, res: resultText });
            if(logs.length > 50) logs.pop(); // æœ€å¤§50ä»¶
            DB.set('logs', logs);
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ©ç”¨å›æ•°åŠ ç®—
            currentUser.usageCount++;
            DB.set('user', currentUser);
            updateRank();
        }

        function toggleLog() {
            const m = document.getElementById('log-modal');
            const c = document.getElementById('log-container');
            if (m.style.display === 'flex') {
                m.style.display = 'none';
            } else {
                m.style.display = 'flex';
                c.innerHTML = logs.length ? '' : '<div style="text-align:center; padding:20px; color:#999;">å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                logs.forEach(l => {
                    c.innerHTML += `<div class="log-item"><div class="log-time">${l.time} - ${l.tool}</div><div>${l.res}</div></div>`;
                });
            }
        }
        function clearLogs() { logs = []; DB.set('logs', []); toggleLog(); }

        // --- ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½ ---
        function toggleFav(id, e) {
            e.stopPropagation();
            if(favorites.includes(id)) favorites = favorites.filter(f => f !== id);
            else favorites.push(id);
            DB.set('favs', favorites);
            renderGrid(); // å†æç”»
        }

        // --- ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ ---
        function toggleTheme() {
            const body = document.body;
            if(body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                DB.set('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                DB.set('theme', 'dark');
            }
        }

        // ============================
        // â–  ãƒ„ãƒ¼ãƒ«å®šç¾© (å¤§é‡è¿½åŠ )
        // ============================
        const tools = [
            // --- Calc ---
            { id: 'discount', cat: 'calc', icon: 'fa-tags', title: 'å‰²å¼•è¨ˆç®—', desc: 'X% OFFã®è¨ˆç®—', 
              html: `<div style="display:flex; gap:10px;"><input type="number" id="dc_p" placeholder="ä¾¡æ ¼"><input type="number" id="dc_r" placeholder="å‰²å¼•ç‡(%)"></div><button class="action-btn" onclick="runDisc()">è¨ˆç®—</button>` },
            { id: 'tax', cat: 'calc', icon: 'fa-shopping-bag', title: 'æ¶ˆè²»ç¨è¨ˆç®—', desc: '8% / 10% åˆ‡ã‚Šæ›¿ãˆ', 
              html: `<input type="number" id="tx_v"><button class="action-btn" onclick="runTax()">è¨ˆç®—</button>` },
            { id: 'invest', cat: 'calc', icon: 'fa-chart-line', title: 'ç©ç«‹æŠ•è³‡ã‚·ãƒŸãƒ¥', desc: 'æ¯æœˆç©ç«‹ã®è¤‡åˆ©è¨ˆç®—', 
              html: `<input type="number" id="iv_m" placeholder="æ¯æœˆã®ç©ç«‹é¡(ä¸‡å††)"><input type="number" id="iv_r" placeholder="å¹´åˆ©(%)"><input type="number" id="iv_y" placeholder="ç©ç«‹å¹´æ•°"><button class="action-btn" onclick="runInvest()">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>` },
            { id: 'tip', cat: 'calc', icon: 'fa-coins', title: 'ãƒãƒƒãƒ—è¨ˆç®—', desc: 'æµ·å¤–æ—…è¡Œç”¨ã®ãƒãƒƒãƒ—è¨ˆç®—', 
              html: `<input type="number" id="tp_v" placeholder="è«‹æ±‚é¡"><input type="number" id="tp_r" placeholder="ãƒãƒƒãƒ—(%) ä¾‹:15"><button class="action-btn" onclick="runTip()">è¨ˆç®—</button>` },

            // --- Date ---
            { id: 'age', cat: 'date', icon: 'fa-birthday-cake', title: 'å¹´é½¢ãƒ»æ—¥æ•°', desc: 'ç”Ÿã¾ã‚Œã¦ä½•æ—¥ï¼Ÿ', 
              html: `<input type="date" id="ag_d"><button class="action-btn" onclick="runAge()">è¨ˆç®—</button>` },
            { id: 'timer', cat: 'date', icon: 'fa-hourglass-start', title: '3åˆ†ã‚¿ã‚¤ãƒãƒ¼', desc: 'ã‚«ãƒƒãƒ—éººç”¨ã‚¿ã‚¤ãƒãƒ¼', 
              html: `<button class="action-btn" onclick="runTimer(180)">3åˆ†ã‚¹ã‚¿ãƒ¼ãƒˆ</button><div id="tm_disp" style="font-size:40px; text-align:center; margin-top:20px;">03:00</div>` },
            { id: 'wclock', cat: 'date', icon: 'fa-globe', title: 'ä¸–ç•Œæ™‚è¨ˆ', desc: 'NY, ãƒ­ãƒ³ãƒ‰ãƒ³ã®æ™‚é–“', 
              html: `<button class="action-btn" onclick="runWClock()">ä»Šã®æ™‚é–“ã‚’å–å¾—</button>` },

            // --- Text ---
            { id: 'count', cat: 'text', icon: 'fa-file-lines', title: 'æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ', desc: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚«ã‚¦ãƒ³ãƒˆ', 
              html: `<textarea id="cnt_t" rows="5" oninput="runCount()"></textarea>` },
            { id: 'lorem', cat: 'text', icon: 'fa-paragraph', title: 'ãƒ€ãƒŸãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ', desc: 'Lorem Ipsumç”Ÿæˆ', 
              html: `<button class="action-btn" onclick="runLorem()">ç”Ÿæˆã‚³ãƒ”ãƒ¼</button>` },
            { id: 'speech', cat: 'text', icon: 'fa-volume-up', title: 'èª­ã¿ä¸Šã’', desc: 'ãƒ–ãƒ©ã‚¦ã‚¶ãŒå–‹ã‚Šã¾ã™', 
              html: `<textarea id="sp_t" placeholder="å–‹ã‚‰ã›ãŸã„è¨€è‘‰"></textarea><button class="action-btn" onclick="runSpeech()">å†ç”Ÿ</button>` },
            { id: 'reverse', cat: 'text', icon: 'fa-exchange-alt', title: 'æ–‡å­—åè»¢', desc: 'é€†ã‹ã‚‰èª­ã‚€', 
              html: `<input type="text" id="rev_t"><button class="action-btn" onclick="runRev()">åè»¢</button>` },

            // --- Dev ---
            { id: 'qr', cat: 'dev', icon: 'fa-qrcode', title: 'QRç”Ÿæˆ', desc: 'URLã‚’QRåŒ–', 
              html: `<input type="text" id="qr_v"><button class="action-btn" onclick="runQR()">ä½œæˆ</button><div id="qr_area" style="margin-top:20px;display:flex;justify-content:center;"></div>` },
            { id: 'pass', cat: 'dev', icon: 'fa-key', title: 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆ', desc: 'å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰', 
              html: `<button class="action-btn" onclick="runPass()">ç”Ÿæˆ</button>` },
            { id: 'ua', cat: 'dev', icon: 'fa-desktop', title: 'ç’°å¢ƒç¢ºèª', desc: 'UserAgentç¢ºèª', 
              html: `<button class="action-btn" onclick="runUA()">ç¢ºèª</button>` },
            { id: 'color', cat: 'dev', icon: 'fa-palette', title: 'ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼', desc: 'è‰²ã®ã‚³ãƒ¼ãƒ‰å–å¾—', 
              html: `<input type="color" id="cl_p" onchange="runColor()"><div id="cl_res"></div>` },

            // --- Life ---
            { id: 'todo', cat: 'life', icon: 'fa-check-square', title: 'ç°¡æ˜“ToDo', desc: 'ä¸€æ™‚çš„ãªãƒ¡ãƒ¢ãƒªã‚¹ãƒˆ', 
              html: `<input type="text" id="td_i" placeholder="ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›"><button class="action-btn" onclick="runTodo()">è¿½åŠ </button><ul id="td_l" style="margin-top:20px;"></ul>` },
            { id: 'dice', cat: 'life', icon: 'fa-dice', title: 'ã‚µã‚¤ã‚³ãƒ­', desc: 'é‹è©¦ã—', 
              html: `<button class="action-btn" onclick="runDice()">æŒ¯ã‚‹</button>` },
        ];

        // --- ã‚°ãƒªãƒƒãƒ‰æç”» ---
        function renderGrid(filterCat = 'all', keyword = '') {
            const grid = document.getElementById('grid-container');
            const stage = document.getElementById('tool-stage');
            grid.innerHTML = '';
            stage.innerHTML = '';
            grid.style.display = 'grid';

            // ãŠæ°—ã«å…¥ã‚Šãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®å ´åˆã¯åˆ¥å‡¦ç†
            let targets = tools;
            if(filterCat === 'fav') {
                targets = tools.filter(t => favorites.includes(t.id));
                if(targets.length === 0) grid.innerHTML = '<p style="grid-column:1/-1; text-align:center;">ãŠæ°—ã«å…¥ã‚ŠãŒã‚ã‚Šã¾ã›ã‚“ã€‚â˜…ã‚’æŠ¼ã—ã¦è¿½åŠ ã—ã‚ˆã†ï¼</p>';
            }

            targets.forEach(tool => {
                // æ¤œç´¢ & ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿
                const matchCat = filterCat === 'all' || filterCat === 'fav' ? true : tool.cat === filterCat;
                const matchKey = keyword === '' || tool.title.includes(keyword) || tool.desc.includes(keyword);

                if (matchCat && matchKey) {
                    const isFav = favorites.includes(tool.id);
                    const card = document.createElement('div');
                    card.className = 'tool-card';
                    card.innerHTML = `
                        <div class="card-header">
                            <div class="card-icon"><i class="fas ${tool.icon}"></i></div>
                            <i class="fas fa-star fav-btn ${isFav ? 'active' : ''}" onclick="toggleFav('${tool.id}', event)"></i>
                        </div>
                        <div class="card-title">${tool.title}</div>
                        <div class="card-desc">${tool.desc}</div>
                    `;
                    card.onclick = () => openTool(tool);
                    grid.appendChild(card);
                }
            });
        }

        function openTool(tool) {
            document.getElementById('grid-container').style.display = 'none';
            document.getElementById('tool-stage').innerHTML = `
                <div class="tool-view active">
                    <div class="back-btn" onclick="renderGrid()"><i class="fas fa-arrow-left"></i> æˆ»ã‚‹</div>
                    <h2><i class="fas ${tool.icon}" style="color:var(--primary)"></i> ${tool.title}</h2>
                    <p>${tool.desc}</p>
                    <hr style="border:0; border-top:1px solid var(--border); margin:20px 0;">
                    ${tool.html}
                    <div id="result" class="result-area" style="display:none;"></div>
                </div>
            `;
            // ToDoã®ã‚ˆã†ãªç‰¹æ®ŠåˆæœŸåŒ–ãŒå¿…è¦ãªå ´åˆ
            if(tool.id === 'todo') renderTodoList();
        }

        function filterCategory(cat) {
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
            renderGrid(cat);
        }
        function searchTools(val) { renderGrid('all', val); }
        function showRes(txt, toolId) {
            const el = document.getElementById('result');
            el.style.display = 'block';
            el.innerHTML = txt;
            // ãƒ­ã‚°ä¿å­˜
            if(toolId) {
                const title = tools.find(t=>t.id===toolId).title;
                addLog(title, txt.replace(/<[^>]*>?/gm, '')); // ã‚¿ã‚°é™¤å»ã—ã¦ä¿å­˜
            }
        }

        // ============================
        // â–  ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
        // ============================
        
        // Calc
        function runDisc() {
            const p = Number(document.getElementById('dc_p').value);
            const r = Number(document.getElementById('dc_r').value);
            const res = Math.floor(p * (1 - r/100));
            showRes(`${res} å†† <span style="font-size:12px">(${p-res}å††ãŠå¾—)</span>`, 'discount');
        }
        function runTax() {
            const v = Number(document.getElementById('tx_v').value);
            showRes(`8%: ${Math.floor(v*1.08)}å††<br>10%: ${Math.floor(v*1.1)}å††`, 'tax');
        }
        function runInvest() {
            const m = Number(document.getElementById('iv_m').value) * 10000;
            const r = Number(document.getElementById('iv_r').value) / 100;
            const y = Number(document.getElementById('iv_y').value);
            let total = 0;
            for(let i=0; i<y*12; i++) { total = (total + m) * (1 + r/12); }
            showRes(`${y}å¹´å¾Œã®è³‡ç”£: <br><span style="color:var(--primary); font-size:28px;">${Math.floor(total).toLocaleString()} å††</span>`, 'invest');
        }
        function runTip() {
            const v = Number(document.getElementById('tp_v').value);
            const r = Number(document.getElementById('tp_r').value);
            showRes(`ãƒãƒƒãƒ—: ${Math.floor(v*r/100)} <br>ç·é¡: ${Math.floor(v*(1+r/100))}`, 'tip');
        }

        // Date
        function runAge() {
            const d = new Date(document.getElementById('ag_d').value);
            const diff = Math.floor((new Date() - d) / 86400000);
            showRes(`${diff}æ—¥ çµŒé`, 'age');
        }
        function runTimer(sec) {
            let s = sec;
            const el = document.getElementById('tm_disp');
            const timer = setInterval(() => {
                s--;
                const min = String(Math.floor(s/60)).padStart(2,'0');
                const sc = String(s%60).padStart(2,'0');
                el.innerText = `${min}:${sc}`;
                if(s<=0) { clearInterval(timer); el.innerText="TIME UP!"; alert('æ™‚é–“ã§ã™ï¼'); }
            }, 1000);
        }
        function runWClock() {
            const now = new Date();
            const ny = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
            const lon = new Date(now.toLocaleString("en-US", {timeZone: "Europe/London"}));
            showRes(`ğŸ‡¯ğŸ‡µ æ—¥æœ¬: ${now.getHours()}:${now.getMinutes()}<br>ğŸ‡ºğŸ‡¸ NY: ${ny.getHours()}:${ny.getMinutes()}<br>ğŸ‡¬ğŸ‡§ London: ${lon.getHours()}:${lon.getMinutes()}`, 'wclock');
        }

        // Text
        function runCount() {
            const v = document.getElementById('cnt_t').value;
            showRes(`${v.length} æ–‡å­—`, null); // ãƒ­ã‚°ãªã—
        }
        function runLorem() {
            const txt = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.";
            navigator.clipboard.writeText(txt);
            showRes("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", 'lorem');
        }
        function runSpeech() {
            const t = document.getElementById('sp_t').value;
            const u = new SpeechSynthesisUtterance(t);
            u.lang = 'ja-JP';
            speechSynthesis.speak(u);
            showRes("å†ç”Ÿä¸­...", 'speech');
        }
        function runRev() {
            const v = document.getElementById('rev_t').value;
            showRes(v.split('').reverse().join(''), 'reverse');
        }

        // Dev
        function runQR() {
            const v = document.getElementById('qr_v').value;
            document.getElementById('qr_area').innerHTML = "";
            new QRCode(document.getElementById('qr_area'), v);
            showRes("ç”Ÿæˆå®Œäº†", 'qr');
        }
        function runPass() {
            const c = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$";
            let p = "";
            for(let i=0;i<16;i++) p += c.charAt(Math.floor(Math.random()*c.length));
            showRes(p, 'pass');
        }
        function runUA() {
            showRes(navigator.userAgent, 'ua');
        }
        function runColor() {
            const v = document.getElementById('cl_p').value;
            document.getElementById('cl_res').innerText = v;
        }

        // Life
        let todos = [];
        function runTodo() {
            const v = document.getElementById('td_i').value;
            if(v) { todos.push(v); renderTodoList(); document.getElementById('td_i').value=''; }
        }
        function renderTodoList() {
            const ul = document.getElementById('td_l');
            if(!ul) return;
            ul.innerHTML = '';
            todos.forEach((t, i) => {
                ul.innerHTML += `<li>${t} <button onclick="todos.splice(${i},1);renderTodoList()" style="padding:2px 5px;">æ¶ˆ</button></li>`;
            });
        }
        function runDice() {
            showRes(Math.floor(Math.random()*6)+1, 'dice');
        }

    </script>
</body>
</html>
